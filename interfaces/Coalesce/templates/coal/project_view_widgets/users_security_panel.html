{% if error %}
    <script>showMessage('error', "{{ error }}");</script>
{% endif %}

<h3 class="row-header">Users and Security</h3>

<div class="row-fluid">
    <div class="col-sm-6">
        <table class="table table-striped table-hover table-responsive table-bordered">
            <thead>
            <tr class="bg-primary">
                <th>User</th>
                <th>Role</th>
                <th>Enabled</th>
                <th>
                    <button id="create-user" class="btn btn-xs btn-success pull-right"><i class="fa fa-plus"></i>
                    </button>
                </th>
            </tr>
            </thead>
            <tbody>
            {% if users %}
                {% for user in users %}
                    <tr id="{{ user.info.user_id }}" class="user">
                        <td class="user-name">
                            <a href="/projects/{{ project.project_name }}/{{ project.project_id }}/user/{{ user.username }}/view/"
                               data-toggle="tooltip" data-placement="right" title="ID: {{ user.info.user_id }}">
                                {{ user.info.username }}</a>
                            <span> </span>
                            <a href="mailto:{{ user.info.email }}">[{{ user.info.email }}]</a>
                        </td>
                        <td class="user-role">
                            {{ user.info.user_role }}
                        </td>
                        <td class="user-enabled center-text {% if user.info.user_enabled == "TRUE" %}bg-success{% else %}bg-danger{% endif %}">
                            {% if user.info.user_enabled == "TRUE" %}
                                TRUE
                            {% else %}
                                FALSE
                            {% endif %}
                        </td>
                        <td class="user-actions">
                            <div class="btn-group actions-dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                   aria-expanded="false">
                                    actions
                                    <span class="caret"></span>
                                </a>
                                <ul class="dropdown-menu table-dropdown">
                                    {% if user.info.user_enabled == "TRUE" %}
                                        <li><a href="#" class="disable-user">disable</a></li>
                                    {% else %}
                                        <li><a href="#" class="enable-user">enable</a></li>
                                    {% endif %}
                                    <li><a href="#" class="remove-user">remove</a></li>
                                    <li><a href="#" class="delete-user"> delete</a></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr class="user-placeholder text-warning">
                    <td><p><i>This project has no users</i></p></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    </div>
    <div class="col-sm-6">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">Networking Stats</h3>
            </div>
            <div class="panel-body center-text">
                {% if user_level == 0 and project_id != project.project_id %}
                    <span id="group-stats">
                        <script>
                            generateQuotaPie("group-stats", [['project', "{{ tenant_info.num_groups }}"], ['cloud', "{{ limits.totalSecurityGroupsUsed }}"], ['available', "{{ quota.security_groups }}"]], "# Security Groups");
                        </script>
                    </span>
                    <span id="key-stats">
                        <script>
                            generateQuotaPie("key-stats", [['cloud', "{{ tenant_info.num_keys }}"], ['available', "{{ quota.key_pairs }}"]], "# Security Keys");
                        </script>
                    </span>
                {% else %}
                    <span id="group-stats">
                        <script>
                            generateQuotaPie("group-stats", [['used', "{{ tenant_info.num_groups }}"], ['available', "{{ quota.security_groups }}"]], "# Security Groups");
                        </script>
                    </span>
                    <span id="key-stats">
                        <script>
                            generateQuotaPie("key-stats", [['used', "{{ tenant_info.num_keys }}"], ['available', "{{ quota.key_pairs }}"]], "# Security Keys");
                        </script>
                    </span>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<h3 class="row-header">Security Groups and Keys</h3>

<div class="row-fluid">
    <div class="col-sm-6">
        <table class="table table-striped table-hover table-responsive table-bordered">
            <thead class="bg-primary">
            <tr>
                <th>Security Group</th>
                <th>Owner</th>
                <th>
                    <button id="create-group" class="btn btn-xs btn-success pull-right"><i class="fa fa-plus"></i>
                    </button>
                </th>
            </tr>
            </thead>
            <tbody>
            {% if groups %}
                {% for group in groups %}
                    <tr id="{{ group.sec_group_id }}" class="group">
                        <td class="group-name">
                            <a href="/security_group/{{ group.sec_group_id }}/{{ group.project_id }}/view/"
                               data-toggle="tooltip" data-placement="right"
                               title="ID: {{ group.sec_group_id }}">{{ group.sec_group_name }}
                            </a>
                        </td>
                        <td class="group-owner">
                            {{ group.username }}
                        </td>
                        <td class="group-actions">
                            <div class="btn-group actions-dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                   aria-expanded="false">
                                    actions
                                    <span class="caret"></span>
                                </a>
                                <ul class="dropdown-menu table-dropdown">
                                    <li><a href="#" class="delete-group">delete</a></li>
                                    <li><a href="#" class="update-group">update</a></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr class="group-placeholder text-warning">
                    <td><p><i>This project has no security groups</i></p></td>
                    <td></td>
                    <td></td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    </div>
    <div class="col-sm-6">
        <table class="table table-striped table-hover table-responsive table-bordered">
            <thead class="bg-primary">
            <tr>
                <th>Security Key</th>
                <th>Owner</th>
                <th>
                    <button id="create-key" class="btn btn-xs btn-success pull-right"><i class="fa fa-plus"></i>
                    </button>
                </th>
            </tr>
            </thead>
            <tbody>
            {% if keys %}
                {% for key in keys %}
                    <tr id="{{ key.key_id }}" class="key">
                        <td class="key-name">
                            <a href="/key_pair/{{ key.key_id }}/{{ project.project_id }}/view/"
                               data-toggle="tooltip" data-placement="right"
                               title="ID: {{ key.key_id }}">{{ key.key_name }}
                            </a>
                        </td>
                        <td class="key-owner">
                            <span id="{{ key.key_id }}-user-text">{{ key.username }}</span>
                        </td>
                        <td class="key-actions">
                            <div class="btn-group actions-dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                   aria-expanded="false">
                                    actions
                                    <span class="caret"></span>
                                </a>
                                <ul class="dropdown-menu table-dropdown">
                                    <li><a href="#" class="delete-key">delete</a></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr class="key-placeholder text-warning">
                    <td><p><i>You have no keys defined</i></p></td>
                    <td></td>
                    <td></td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    </div>
</div>
<script>
    $('[data-toggle="tooltip"]').tooltip();
</script>
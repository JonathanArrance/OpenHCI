<!-- Begin instance widget-->
<div class="span4">
    <div class="well instance-management-well">
        <div class="legend">

            <div id="instance_progressbar" class="ui-progressbar progressbar">
                <span class="progressbar-text">Working</span>
            </div>

            Instances

            <a href="#" id="create-instance" class="btn" style="float:right">Create</a>
        </div>

        <div class="well-tall instance-management-table">
            <table class="paleblue widget-table table-tall" id="instance_list">
                <tr>
                    <th>Name</th>
                    <th>Status</th>
                    <th>OS / flavor</th>
                    <th>Actions</th>
                </tr>
                <script>instanceOpts.clear();</script>
                {% if instances %}
                {% for k,v in instance_info.items %}
                <script>
                    instances.setItem(
                            "{{v.server_id}}",
                            { id: "{{v.server_id}}", name: "{{v.server_name}}", status: "{{v.server_status}}",
                                flavor: "{{v.server_flavor}}", os: "{{v.server_os}}", console: "{{v.novnc_console}}" });
                    instanceOpts.setItem(
                            "{{v.server_id}}",
                            { value: "{{v.server_id}}", option: "{{v.server_name}}" });
                    consoleLinks.setItem("{{v.server_id}}",
                            {
                                link: "{{v.novnc_console}}",
                                html: '<a href=\"{{v.novnc_console}}\" class=\"open-instance-console\" onClick=\"window.open(this.href,\'_blank\',\'toolbar=no, location=no, status=no, menubar=no, titlebar = no, scrollbars=yes, resizable=yes, width=720, height=435\'); return false;\">console</a>'
                            }
                    );
                </script>
                <tr id="{{v.server_id}}"
                    class="{% if v.server_status == 'PAUSED' %}instance-paused{% endif %}{% if v.server_status == 'SUSPENDED' %}instance-suspended{% endif %}">
                    <td id="{{v.server_id}}-name-cell">
                        <a href="/{{project.project_id}}/{{v.server_id}}/instance_view/" class="disable-link"><span
                                id="{{v.server_id}}-name-text">{{v.server_name}}</span></a>
                    </td>
                    <td id="{{v.server_id}}-status-cell">{{v.server_status}}</td>
                    <td id="{{v.server_id}}-os-cell">{{v.server_os}} / {{v.server_flavor}}</td>
                    <td id="{{v.server_id}}-actions-cell">
                        {% if v.server_status == "ACTIVE" %}
                        <a href="{{v.novnc_console}}" class="open-instance-console"
                           onClick="window.open(this.href,'',
                                   'toolbar=no, location=no, status=no, menubar=no, titlebar = no, scrollbars=yes, resizable=yes, width=720, height=435');
                        return false;">console</a>
                        <span class="instance-actions-pipe"> | </span>
                        <a href="#" class="pause-instance">pause</a>
                        <span class="instance-actions-pipe"> | </span>
                        <a href="#" class="suspend-instance">suspend</a>
                        {% endif %}
                        {% if v.server_status == "PAUSED" %}
                        <a href="#" class="unpause-instance">unpause</a>
                        {% endif %}
                        {% if v.server_status == "SUSPENDED" %}
                        <a href="#" class="resume-instance">resume</a>
                        {% endif %}
                        <span class="instance-actions-pipe"> | </span>
                        <a href="#" class="delete-instance">delete</a>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr id="instance_placeholder">
                    <td><p><i>This project has no instances</i></p></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                {% endif %}
            </table>
        </div>
    </div>
</div>

<div id="instance-dialog-form" title="Create Instance">
    <p class="validateTips">Create a new instance. All form fields are required.</p>

    <form>
        {% csrf_token %}
        <fieldset>

            <label for="name">Instance Name</label>
            <input type="text" name="name" id="name"
                   class="text ui-widget-content ui-corner-all instance-text-field"/>

            <label for="sec_group_name">Security Group</label>
            <select name="sec_group_name" id="sec_group_name">
                <script>secGroupInstOpts.clear();</script>
                {% for sg in sec_groups %}
                <script>
                    secGroupInstOpts.setItem(
                            "{{sg.sec_group_name}}",
                            { value: "{{sg.sec_group_name}}", option: "{{sg.sec_group_name}}" }
                    );
                </script>
                {% endfor %}
                <script>refreshSelect($("#sec_group_name"), secGroupInstOpts);</script>
            </select>

            <label for="sec_key_name">Security Key</label>
            <select name="sec_key_name" id="sec_key_name">
                <script>secKeyInstOpts.clear();</script>
                {% for sk in sec_keys %}
                <script>
                    secKeyInstOpts.setItem(
                            "{{sk.key_name}}",
                            { value: "{{sk.key_name}}", option: "{{sk.key_name}}" }
                    );
                </script>
                {% endfor %}
                <script>refreshSelect($("#sec_key_name"), secKeyInstOpts);</script>
            </select>

            <label for="network_name">Private Network</label>
            <select name="network_name" id="network_name">
                <script>privNetInstOpts.clear();</script>
                {% for net in priv_net_list %}
                <script>
                    privNetInstOpts.setItem(
                            "{{net.net_name}}",
                            { value: "{{net.net_name}}", option: "{{net.net_name}}" }
                    );
                </script>
                {% endfor %}
                <script>refreshSelect($("#network_name"), privNetInstOpts);</script>
            </select>

            <label for="image_name">Image</label>
            <select name="image_name" id="image_name">
                <script>imageInstOpts.clear();</script>
                {% for image in images %}
                <script>
                    imageInstOpts.setItem(
                            "{{image.image_name}}",
                            { value: "{{image.image_name}}", option: "{{image.image_name}}" }
                    )
                </script>
                {% endfor %}
                <script>refreshSelect($("#image_name"), imageInstOpts);</script>
            </select>

            <label for="flavor_name">Flavor</label>
            <select name="flavor_name" id="flavor_name">
                {% for flavor in flavors %}
                <option value="{{flavor.flavor_name}}">{{flavor.flavor_name}}</option>
                {% endfor %}
            </select>
        </fieldset>
    </form>
</div>

{% if user_level == 0 %}

<div id="instance-pause-confirm-form" title="Pause Instance">
    <p style="text-align:center;">Pause <span class="instance-name"></span>?</p>
</div>

<div id="instance-suspend-confirm-form" title="Suspend Instance">
    <p style="text-align:center;">Suspend <span class="instance-name"></span>?</p>
</div>

<div id="instance-unpause-confirm-form" title="Unpause Instance">
    <p style="text-align:center;">Unpause <span class="instance-name"></span>?</p>
</div>

<div id="instance-resume-confirm-form" title="Resume Instance">
    <p style="text-align:center;">Resume <span class="instance-name"></span>?</p>
</div>

<div id="instance-delete-confirm-form" title="Delete Instance">
    <p style="text-align:center;">Delete <span class="instance-name"></span>?</p>
</div>

{% endif %}
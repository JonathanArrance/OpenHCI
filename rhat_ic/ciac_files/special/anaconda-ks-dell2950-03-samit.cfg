# Kickstart file automatically generated by anaconda.

#version=DEVEL
install
cdrom
lang en_US.UTF-8
keyboard us
reboot

#Mgmtnet
network  --activate --onboot yes --device em1 --bootproto static --noipv6
network  --activate --onboot yes --device bond0 --bootproto dhcp --bondopts=mode=active-backup,miimon=100,primary=em1 --noipv6 --bondslaves em1

#Datanet
network --activate --onboot yes --device p2p3 --bootproto static --noipv6
network --activate --onboot yes --device p2p4 --bootproto static --noipv6
network --activate --onboot yes --device bond1 --bootproto static --ip=172.24.24.10 --netmask=255.255.255.0 --bondopts=mode=balance-alb,miimon=100,primary=p1p3 --noipv6 --bondslaves p1p3,p1p4

#Uplink
network --activate --onboot yes --device p2p1 --bootproto static --noipv6
network --activate --onboot yes --device p2p2 --bootproto static --noipv6

#HA
network --activate --onboot yes --device em2 --bootproto static --noipv6
network --activate --onboot yes --device bond3 --bootproto dhcp --bondopts=mode=active-backup,miimon=100,primary=em2 --noipv6 --bondslaves em2


rootpw  --iscrypted $6$2Hd0d.j2Pud2GDqW$JMBdYd3Jxt51LsiBOW6ZGuTZpk.I.dZyy20jlCenybz5a748/ZUzHuixaO3rfqsq1ZS4ASS/hbKqDBGVJKcGF0
#rootpw  --iscrypted $6$NNfrbE5AwWKha5xp$0RZiitBYfQfDmZUsRMlv58j.1W9Ajlg04EM.h2k0Mc.o41A.Ugn3Qywk4CquAQ0tcjImDfqw9sy/ZEbrNRHRB1
firewall --disabled
authconfig --enableshadow --passalgo=sha512
#selinux --disabled
selinux --disabled
timezone --utc America/New_York
group --name transystem
#user --name=transuser --groups=transystem --homedir=/home/transuser --password $6$NNfrbE5AwWKha5xp$0RZiitBYfQfDmZUsRMlv58j.1W9Ajlg04EM.h2k0Mc.o41A.Ugn3Qywk4CquAQ0tcjImDfqw9sy/ZEbrNRHRB1 --iscrypted
user --name=transuser --groups=transystem --homedir=/home/transuser --password $6$2Hd0d.j2Pud2GDqW$JMBdYd3Jxt51LsiBOW6ZGuTZpk.I.dZyy20jlCenybz5a748/ZUzHuixaO3rfqsq1ZS4ASS/hbKqDBGVJKcGF0 --iscrypted

bootloader --location=mbr --driveorder=sdb --append="crashkernel=auto rhgb quiet"
#clear the mbr
zerombr
#clear out all partitions
clearpart --all --initlabel
url --url=http://192.168.10.10/image/cent-65-x86-64

part / --size=900000 --ondisk=sdb
part swap --grow --size=13000 --ondisk=sdb

repo --name="CentOS"  --baseurl=http://192.168.10.10/image/cent-65-x86-64 --cost=100

reboot

%packages
@additional-devel
@core
@hardware-monitoring
@ha
@ha-management
@load-balancer
@resilient-storage
@scalable-file-systems
@server-platform-devel
@server-policy
@workstation-policy
@postgresql-client
@postgresql
libgcrypt-devel
libXinerama-devel
libuuid-devel
xorg-x11-proto-devel
startup-notification-devel
libgnomeui-devel
libbonobo-devel
libXau-devel
libXrandr-devel
popt-devel
libxslt-devel
libglade2-devel
gnutls-devel
lm_sensors
%end


%post
#Set up bond0
sed -i 's/HWADDR/#HWADDR/' /etc/sysconfig/network-scripts/ifcfg-bond0

#Set up bond0
sed -i 's/BOOTPROTO=\"dhcp\"/BOOTPROTO=\"static\"/' /etc/sysconfig/network-scripts/ifcfg-bond0
echo 'IPADDR="192.168.10.172"' >> /etc/sysconfig/network-scripts/ifcfg-bond0
echo 'NETMASK="255.255.255.0"' >> /etc/sysconfig/network-scripts/ifcfg-bond0

#add uplink to the bridge
echo 'BRIDGE="br-ex"' >> /etc/sysconfig/network-scripts/ifcfg-p2p1
echo 'PROMISC="yes"' >> /etc/sysconfig/network-scripts/ifcfg-p2p1
sed -i 's/NM_CONTROLLED=\"yes\"/NM_CONTROLLED=\"no\"/' /etc/sysconfig/network-scripts/ifcfg-p2p1
sed -i 's/ONBOOT=\"no\"/ONBOOT=\"yes\"/' /etc/sysconfig/network-scripts/ifcfg-p2p1
sed -i 's/BOOTPROTO=\"static\"/BOOTPROTO=\"none\"/' /etc/sysconfig/network-scripts/ifcfg-p2p1

echo 'PROMISC="yes"' >> /etc/sysconfig/network-scripts/ifcfg-p2p2
sed -i 's/NM_CONTROLLED=\"yes\"/NM_CONTROLLED=\"no\"/' /etc/sysconfig/network-scripts/ifcfg-p2p2
sed -i 's/ONBOOT=\"no\"/ONBOOT=\"yes\"/' /etc/sysconfig/network-scripts/ifcfg-p2p2
sed -i 's/BOOTPROTO=\"static\"/BOOTPROTO=\"none\"/' /etc/sysconfig/network-scripts/ifcfg-p2p2

#Set up bond3
sed -i 's/BOOTPROTO=\"dhcp\"/BOOTPROTO=\"static\"/' /etc/sysconfig/network-scripts/ifcfg-bond3
sed -i 's/NM_CONTROLLED=\"yes\"/NM_CONTROLLED=\"no\"/' /etc/sysconfig/network-scripts/ifcfg-bond3
sed -i 's/TYPE=\"Ethernet\"/TYPE=\"Bond\"/' /etc/sysconfig/network-scripts/ifcfg-bond3
echo 'IPADDR=' >> /etc/sysconfig/network-scripts/ifcfg-bond3
echo 'NETMASK=' >> /etc/sysconfig/network-scripts/ifcfg-bond3
echo 'BONDING_OPTS="mode=active-backup miimon=100 primary=em2"' >> /etc/sysconfig/network-scripts/ifcfg-bond3
sed -i 's/HWADDR=/#HWADDR=/' /etc/sysconfig/network-scripts/ifcfg-bond3

chown -R transuser:transystem /home/transuser
chmod 760 /home/transuser

#get br-ex
wget -P /etc/sysconfig/network-scripts http://192.168.10.10/rhat_ic/network/ifcfg-br-ex

wget -P /root http://192.168.10.10/rhat_ic/ciac_files/special/dell2950-03-samit.sh
%end
